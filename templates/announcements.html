{% extends "layout.html" %}

{% block content %}

{% include "menu.html" %}

{{ menu('announcements') }}

<div style="">
	<div class="row">
		<div class="col-md-4"><h1>Announcements</h1></div>
		<div class="col-md-3 col-md-offset-1">
			<input class="btn btn-default" id="newAnnouncement" type="submit" value="New" style="margin-top:19px" >
		</div>
	</div>
	<div class="row">
		<div class="col-md-4">
			<span id="noAnnouce"></span>
			<div id="annouceContainer"></div>
		</div>
		<div class="col-md-7 col-md-offset-1" id="announceArea">
		</div>
	</div>
</div>

<script>
	var an1 = makeAnnouncement("Testing this Page", "Hello everyone,\n this is a test", "4/10/15"),
		an2 = makeAnnouncement("Moving Space", "Hello, We will be moving to a new space", "4/12/15");
	var announcements = [an2,an1]
	var getAnnouncements = function(){
		console.log("first")
		if (announcements.length === 0){
			$('#noAnnouce').html("<p>You have no announcements</p>")
		}
		else{
			$('#annouceContainer').empty();
			for (var i=0; i<announcements.length; i++){
				var a = announcements[i],
					$div = $('#annouceContainer'),
					$container = $('<div>'),
					$out_t = $('<div>'),
					$out_body = $('<div>'),
					$inside1 = $('<div>'),
					$inside2 = $('<div>'),
					$body = $('<div>'),
					body = $('<p>');

				$container.attr('id',"message "+i)
				$out_t.addClass('row');
				$inside1.addClass('col-md-9');
				$inside2.addClass('col-md-3');

				$inside1.html("<h4><strong>"+a.subject+"</strong></h4>");
				$inside2.html("<h4>"+a.time+"</h4>");

				$out_body.addClass('row');
				$body.addClass('col-md-12');

				body.text(a.body);
				$body.append(body);
				$out_body.append($body);
				$container.css("cursor","default");
				$container.css("height","60px")
				$container.css("overflow","hidden")

				$out_t.append($inside1).append($inside2);
				$div.append($container.append($out_t).append($out_body)); 
				$container[0].addEventListener("click",function(e){
					var x = e.clientX,
						y = e.clientY,
						item = getItemFromPx(x,y);
					displayAnnouncement(item);
				},false);
			}
		}
	}


	makeAnnouncement = function(subject, body, time){
		return {"subject":subject, "body":body, "time":time}
	}

	makeAddNewAnnouncement = function(){
		var $area = $('#announceArea'),
			$subject = getNewSubject(),
			$body = getNewBody(),
			$button = getNewButton();

		$area.empty();
		$area.append($subject).append($body).append($button);
		$('#addAnnouncement').click(function(){
			console.log("the");
			var $area = $('#announceArea'),
				subject = $('#addAnnounceSub').val(),
				body = $('#addAnnounceBody').val();
				d = new Date(),
				month = d.getMonth()+1,
				day = d.getDate(),
				year = ""+d.getFullYear(),
				time = ""+month+"/"+day+"/"+year.slice(2,4)
				announcement = makeAnnouncement(subject,body,time);

			announcements.unshift(announcement);
			getAnnouncements();
			makeAddNewAnnouncement();
		});

	}

	getNewSubject = function(){
		var $row = $('<div>'),
			$col = $('<div>'),
			$input = $('<input>');

		$row.addClass('row');
		$col.addClass('col-md-12');
		$input.attr('id', 'addAnnounceSub');
		$input.attr('type','text');
		$input.attr('size','22%');
		$input.attr('placeholder','Subject');

		return $row.append($col.append($input));
	}

	getNewBody = function(){
		var $row = $('<div>'),
			$col = $('<div>'),
			$input = $('<textarea>');	
			
		$row.addClass('row');
		$row.css('margin-top','5px');
		$col.addClass('col-md-12');

		$input.attr('id','addAnnounceBody');
		$input.attr('cols','29%');
		$input.attr('placeholder','Message');

		return $row.append($col.append($input));
	}

	getNewButton = function(){
		var $row = $('<div>'),
			$col = $('<div>'),
			$input = $('<input>');	
			
		$row.addClass('row');
		$row.css('margin-top','5px');
		$col.addClass('col-md-12');
		
		$input.attr('type','submit');
		$input.attr('value','Add')
		$input.attr('id','addAnnouncement');
		$input.addClass("btn btn-default")

		return $row.append($col.append($input));
	}

	getItemFromPx = function(x,y){
		var xOffset = 15,
			yOffset = 163,
			newX = x-xOffset,
			newY = y-yOffset,
			space = 60,
			index;

			index = Math.floor(newY/60);
			return announcements[index];
	}

	displayAnnouncement = function(item){
		var $area = $('#announceArea'),
			subject = item.subject,
			body = item.body,
			time = item.time,
			$row1 = $('<div>').addClass("row"),
			$row2 = $('<div>').addClass("row"),
			$subject = $('<div>').addClass("col-md-4"),
			$time = $('<div>').addClass("col-md-3 col-md-offset-1"),
			$body = $('<div>').addClass("col-md-8");

		$subject.html("<h4><strong>"+subject+"</strong></h4>");
		$time.html("<h4>"+time+"</h4>");
		$body.html("<p>"+body+"</p>");

		$row1.append($subject).append($time);
		$row2.append($body);

		$area.empty();
		$area.append($row1).append($row2);
	}

	$('#newAnnouncement').click(function(){
		makeAddNewAnnouncement();
	});


	getAnnouncements();
	makeAddNewAnnouncement();
</script>

{% endblock %}